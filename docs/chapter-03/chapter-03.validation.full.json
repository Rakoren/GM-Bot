{
  "schema_version": "0.4.0",
  "chapter": 3,
  "title": "chapter-03.validation.full",
  "generated_at": "2026-01-27",

  "validation_profile": "full",
  "inputs": {
    "manifest_path": "chapter-03/manifest.json",
    "index_aggregate_optional": "Chapter-03-index-hardened-v2"
  },

  "required_types": ["class", "spell_list", "resource"],
  "optional_types": ["feature", "subclass", "enum"],

  "checks": [
    {
      "id": "manifest.shards.unique_ids",
      "type": "integrity",
      "severity": "error",
      "rule": "All shards[].id must be unique across the manifest."
    },
    {
      "id": "manifest.shards.paths.present",
      "type": "filesystem",
      "severity": "error",
      "rule": "Every shards[].path must exist on disk."
    },
    {
      "id": "class.core_fields",
      "type": "schema",
      "severity": "error",
      "targets": { "type": "class" },
      "rule": "Class shard must include: id, name, chapter, status, primary_ability, hit_die, saving_throws, proficiencies, spellcasting (nullable), resources (array), features_by_level (object), subclasses (array)."
    },
    {
      "id": "class.features_by_level.keys_are_numeric_strings",
      "type": "schema",
      "severity": "error",
      "targets": { "type": "class" },
      "rule": "features_by_level keys must be numeric strings (e.g., \"1\", \"2\", \"3\")."
    },
    {
      "id": "class.spell_list_ref_resolves",
      "type": "reference",
      "severity": "error",
      "targets": { "type": "class" },
      "rule": "If class.spellcasting.spell_list_ref is set, it must resolve to a spell_list shard id in manifest."
    },
    {
      "id": "spell_list.class_id_consistency",
      "type": "reference",
      "severity": "error",
      "targets": { "type": "spell_list" },
      "rule": "spell_list.class_id (if present) must match a class shard id."
    },
    {
      "id": "class.resources.resolve",
      "type": "reference",
      "severity": "error",
      "targets": { "type": "class" },
      "rule": "Each id in class.resources must resolve to a resource shard id in manifest."
    },
    {
      "id": "class.subclasses.expected_ids",
      "type": "consistency",
      "severity": "warn",
      "targets": { "type": "class" },
      "rule": "Each subclass id in class.subclasses should be included in manifest.expected_subclass_ids. (Warn only; allow custom subclasses.)"
    },
    {
      "id": "spell_list.entries.required_fields",
      "type": "schema",
      "severity": "error",
      "targets": { "type": "spell_list" },
      "rule": "Each spell_list entry must include: level (int), name (string), school (string), special_flags (array)."
    },
    {
      "id": "spell_list.special_flags.allowed",
      "type": "schema",
      "severity": "error",
      "targets": { "type": "spell_list" },
      "rule": "special_flags may only contain: \"C\", \"R\", \"M\"."
    },
    {
      "id": "warlock.pact_magic_caster_type",
      "type": "consistency",
      "severity": "error",
      "targets": { "id": "class.warlock" },
      "rule": "class.warlock.spellcasting.caster_type must equal \"pact_magic\"."
    },
    {
      "id": "wizard.placeholder_spell_list_ok",
      "type": "consistency",
      "severity": "warn",
      "targets": { "id": "spell_list.wizard" },
      "rule": "If spell_list.wizard is a placeholder pending the Spells chapter, allow empty or partial entries but require a notes field explaining placeholder status."
    }
  ],

  "outputs": {
    "report_path": "chapter-03/validation.full.report.json",
    "on_success": "pass",
    "on_failure": "fail"
  },

  "notes": [
    "This is the full validation spec; it assumes you have a validator that reads manifest.json and executes checks.",
    "If you also want a smaller validator, create validation.shards.json with only filesystem+reference checks."
  ]
}
